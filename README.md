---
# Проект SmartHome
---

## Функции, которые должны быть реализованы: 

- Научитесь подключаться к серверу и выполнять HTTP POST запросы на сервер, передавая ему уже готовые закодированные сообщения.
- Научитесь кодировать и декодировать URL-encoded unpadded base64 для отправки на сервер и приёма данных от сервера.
- Научитесь кодировать и декодировать пакеты из бинарной формы в ваше внутреннее представление.
- Научитесь выявлять структуру сети устройств с помощью WHOISHERE. Научитесь управлять одной лампой и одним выключателем. Реализуйте весь требуемый функционал.

## Условие задачи(проекта): 

Напишите программу, которая реализует функции хаба умного дома. В умном доме размещены сенсоры, то есть устройства, измеряющие параметры окружающей среды, актуаторы, то есть устройства, воздействующие на среду в доме, таймер,
передающий показания текущего времени, и хаб, то есть устройство, которое управляет всеми остальными устройствами в умном доме.
Все устройства находятся в общей коммуникационной среде **```сети```**. Информация по сети передаётся с помощью пакетов.
Пакет может отправляться одному устройству, либо всем устройствам одновременно **```broadcast```**. 
Каждое устройство, включая хаб, имеет свой уникальный *```14-битный```* адрес в сети. Коммуникационная среда ненадёжна, то есть пакеты могут в сети теряться либо портиться, но пакеты не дублируются, то есть ситуация,
когда получатель получает один и тот же пакет несколько раз, невозможна. Для моделирования функциональности хаба умного дома ваша программа должна получать данные из сети, и в качестве реакции на полученные данные отправлять данные в сеть.
В рамках данной задачи получение данных из сети и отправка данных в сеть моделируется с помощью **```HTTP POST```** запроса на специальный сервер, который моделирует функционирование остальных устройств умного дома.


## Описание формата пакетов
### Для описания формата данных, передаваемых по сети, используются следующие типы данных:
- ```byte``` — беззнаковое 8-битное значение (октет).
- ```bytes``` — массив байтов переменного размера, этот тип должен конкретизироваться в описании конкретных форматов пакетов в зависимости от типа пакета и типа устройства.
- ```string``` — строка. Первый байт строки хранит ее длину, затем идут символы строки, в строке допустимы символы (байты) с кодами 32-126 (включительно).
- ```varuint``` — беззнаковое целое число в формате ULEB128.
 
- ```[]T``` — массив элементов типа T, первый байт памяти, отводимой под массив, это длина массива, далее следуют байты, кодирующие элементы массива.
- ```struct``` — структура, состоящая из полей произвольного типа. Структура может иметь переменный размер, поскольку поля структуры могут иметь переменный размер, например varuint, string, и т. п.


Каждый пакет, передаваемый по сети, описывается следующим образом:
```
type packet struct {
  length byte
  payload bytes
  crc8 byte
};
```
Где:
- ```length``` — это размер поля payload в октетах (байтах);
- ```payload``` — данные, передаваемые в пакете, конкретный формат данных для каждого типа пакета описывается ниже;
- ```crc8``` — контрольная сумма поля payload, вычисленная по алгоритму cyclic redundancy check 8

Полезная нагрузка (поле payload) имеет следующую структуру:
```
type payload struct {
  src varuint
  dst varuint
  serial varuint
  dev_type byte
cmd byte
  cmd_body bytes
};
```
Где:
- ```src``` - это 14-битный “адрес” устройства-отправителя;
- ```dst``` - 14-битный “адрес” устройства-получателя, причем адреса 0x0000 и 0x3FFF (16383) зарезервированы. Адрес 0x3FFF означает “широковещательную” рассылку, то есть данные адресованы всем устройствам одновременно;
- ```serial``` - это порядковый номер пакета, отправленного устройством, от момента его включения. serial нумеруется с 1;
- ```dev_type``` - это тип устройства, к которому относится пакет; cmd - это команда протокола;
- ```cmd_body``` - формат которого зависит от команды протокола.
Тип устройства ```dev_type``` и команда ```cmd``` в совокупности определяют данные, которые передаются в ```cmd_body```, как будет описано далее. Обратите внимание, что ```dev_type``` - это тип устройства, к которому относится данная команда.
Например, если хаб посылает лампе команду на включение **SETSTATUS**, то и ```dev_type``` у соответствующего пакета должен быть равен 4 (лампа).


